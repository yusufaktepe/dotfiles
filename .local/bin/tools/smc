#!/bin/sh

update_bar() {
	if pidof i3blocks >/dev/null; then
		pkill -SIGRTMIN+6 i3blocks
	elif pidof polybar >/dev/null; then
		pkill -USR1 polyplayer
	else
		return
	fi
}

case "$1" in
	prev|p)
		if pidof mpd >/dev/null; then
			mpc prev && update_bar
		else
			playerctl previous && update_bar
		fi
	;;
	next|n)
		if pidof mpd >/dev/null; then
			mpc next && update_bar
		else
			playerctl next && update_bar
		fi
	;;
	toggle|t)
		if pidof mpd >/dev/null; then
			mpc toggle && update_bar
		else
			playerctl play-pause && update_bar
		fi
	;;
	pauseall|pa)
		mpc pause; playerctl pause;
		for i in /tmp/mpvsoc*; do
			[ -e "$i" ] || break
			echo '{ "command": ["set_property", "pause", true] }' | socat - "$i"
		done
	;;
	volup)
		if pidof mpd >/dev/null; then
			mpc volume +5 >/dev/null
		elif pidof spotify >/dev/null || pidof spotifyd >/dev/null; then
			spotify-vol +5 >/dev/null
		else
			playerctl volume 0.05+
		fi
	;;
	voldown)
		if pidof mpd >/dev/null; then
			mpc volume -5 >/dev/null
		elif pidof spotify >/dev/null || pidof spotifyd >/dev/null; then
			spotify-vol -5 >/dev/null
		else
			playerctl volume 0.05-
		fi
	;;
esac
