#!/bin/sh

_mpv() {
	mpv --load-scripts=no --input-ipc-server=/tmp/mpvsocketYT \
		--really-quiet --volume=60 "$@" >/dev/null 2>&1
}

url() {
	AW_CLASS=$(xprop -id "$(xdotool getactivewindow)" | awk -F'"' '/WM_CLASS/{print $4}')
	case "$AW_CLASS" in
		Vivaldi*|*chrom*|Opera*|firefox*|Tor*|Brave*)
			xdotool key --clearmodifiers Ctrl+l \
				key --clearmodifiers Right \
				keydown --clearmodifiers Shift \
				key Home \
				keyup Shift \
				key Escape
			xclip -o -selection primary | grep -Eo '(http|https)://[^ "]+' ;;
		*)
			xclip -o -selection clipboard | grep -Eo '(http|https)://[^ "]+'
	esac
}

case "$1" in
	mpv)
		case "$2" in
			-c) _mpv "$(xclip -o -selection clipboard)" & ;;
			*) [ -n "$(url)" ] && _mpv "$(url)" & ;;
		esac ;;
	"")
		exit ;;
	*)
		[ -n "$(url)" ] && "$@" "$(url)" >/dev/null 2>&1 &
esac
