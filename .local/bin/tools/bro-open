#!/bin/sh

get_url() {
	AW_CLASS=$(xprop -id "$(xdotool getactivewindow)" | awk -F'"' '/WM_CLASS/{print $4}')
	case "$AW_CLASS" in
		Vivaldi*|*chrom*|Opera*|firefox*|Tor*|Brave*)
			xdotool key --clearmodifiers Ctrl+l \
				key --clearmodifiers Right \
				keydown --clearmodifiers Shift \
				key Home \
				keyup Shift \
				key Escape
			URL=$(xclip -o -selection primary | grep -Eo '(https?|ftp)://[^ "]+') ;;
		mpv)
			PID=$(xprop -root | awk '/_NET_ACTIVE_WINDOW\(WINDOW\)/{print $NF}')
			PID=$(xprop -id "$PID" | grep -m 1 PID | cut -d " " -f 3)
			URL=$(ps -o cmd --no-headers -p "$PID" | grep -Eo '(https?|ftp)://[^ "]+') ;;
		*)
			URL=$(xclip -o -selection clipboard | grep -Eo '(https?|ftp)://[^ "]+')
	esac
}

case $1 in
	mpv) shift
		case $1 in
			-c) ym "$(xclip -o -selection clipboard)" ;;
			*) get_url; [ -n "$URL" ] && ym "$URL" ;;
		esac ;;
	"") exit ;;
	*) get_url; [ -n "$URL" ] && "$@" "$URL" >/dev/null 2>&1 &
esac
