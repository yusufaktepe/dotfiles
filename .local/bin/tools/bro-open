#!/bin/sh

_mpv() {
	mpv --input-ipc-server=/tmp/mpvsoc"$(date +%s)" \
	--really-quiet --volume=60 --autofit=46% --geometry=-2-2 --keep-open "$@"
}

url() {
	AW_CLASS=$(xprop -id "$(xdotool getactivewindow)" | awk -F'"' '/WM_CLASS/{print $4}')
	case "$AW_CLASS" in
		Vivaldi*|*chrom*|Opera*|firefox*)
			xdotool key --clearmodifiers Ctrl+l \
				key --clearmodifiers Right \
				keydown --clearmodifiers Shift \
				key Home \
				keyup Shift \
				key Escape
			xclip -o -selection primary | grep -Eo '(http|https)://[^ "]+' ;;
		*)
			xclip -o -selection clipboard | grep -Eo '(http|https)://[^ "]+'
	esac
}

case "$1" in
	mpv)
		case "$2" in
			-c) _mpv "$(xclip -o -selection clipboard)" & ;;
			*) [ -n "$(url)" ] && _mpv "$(url)" & ;;
		esac ;;
	"")
		exit ;;
	*)
		[ -n "$(url)" ] && "$@" "$(url)"
esac
