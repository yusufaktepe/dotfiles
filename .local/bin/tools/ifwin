#!/bin/sh
# Context-sensitive launcher script
# ---
# 2019 Yusuf Aktepe <yusuf@yusufaktepe.com>
# https://github.com/yusufaktepe/dotfiles
# ---
# IfWinNotExist:  run
# IfWinNotActive: focus
# IfWinActive:    previous focus

AW=$(xdotool getactivewindow)
AW_CLASS=$(xprop -id "$AW" | awk -F'"' '/WM_CLASS/{print $4}')

case "$1" in
	brave)
		if pgrep -x "brave" > /dev/null; then
			if [ "$AW_CLASS" = "Brave-browser" ]; then
				i3-msg "workspace back_and_forth" >/dev/null
			else
				i3-msg '[class="Brave-browser"] focus' >/dev/null
			fi
		else
			exec brave
		fi
	;;
	chrome)
		if pgrep -x "chrome" > /dev/null; then
			if [ "$AW_CLASS" = "Google-chrome" ]; then
				i3-msg "workspace back_and_forth" >/dev/null
			else
				i3-msg '[class="Google-chrome"] focus' >/dev/null
			fi
		else
			exec google-chrome-stable
		fi
	;;
	crow)
		showcrow="alt+ctrl+shift+F1"

		if ! pgrep -x "crow" > /dev/null; then
			exec crow
		else
			if wmctrl -l | grep -q "Crow Translate"; then
				wmctrl -x -a "crow.Crow Translate" && i3-msg kill >/dev/null
			else
				xdotool key --clearmodifiers $showcrow
			fi
		fi
	;;
	doublecmd)
		if pgrep -x "doublecmd" > /dev/null; then
			if [ "$AW_CLASS" = "Doublecmd" ]; then
				i3-msg "workspace back_and_forth" >/dev/null
			else
				i3-msg '[class="Doublecmd"] focus' >/dev/null
			fi
		else
			exec doublecmd --no-splash >/dev/null 2>&1
		fi
	;;
	firefox)
		if pgrep -x "firefox" > /dev/null; then
			if [ "$AW_CLASS" = "firefox" ]; then
				i3-msg "workspace back_and_forth" >/dev/null
			else
				i3-msg '[class="firefox"] focus' >/dev/null
			fi
		else
			exec firefox
		fi
	;;
	opera)
		if pgrep -x "opera" > /dev/null; then
			if [ "$AW_CLASS" = "Opera" ]; then
				i3-msg "workspace back_and_forth" >/dev/null
			else
				i3-msg '[class="Opera"] focus' >/dev/null
			fi
		else
			exec opera --start-maximized
		fi
	;;
	pavucontrol)
		if pgrep -x "pavucontrol" > /dev/null; then
			if [ "$AW_CLASS" = "Pavucontrol" ]; then
				i3-msg kill >/dev/null
				pkill -SIGRTMIN+10 i3blocks
			else
				i3-msg '[class="Pavucontrol"] focus' >/dev/null
			fi
		else
			exec pavucontrol
		fi
	;;
	qbittorrent)
		if pgrep -x "qbittorrent" > /dev/null; then
			if [ "$AW_CLASS" = "qBittorrent" ]; then
				i3-msg "workspace back_and_forth" >/dev/null
			else
				i3-msg '[class="qBittorrent"] focus' >/dev/null
			fi
		else
			exec qbittorrent
		fi
	;;
	smplayer)
		if pgrep -x "smplayer" > /dev/null; then
			if [ "$AW_CLASS" = "smplayer" ]; then
				i3-msg '[class="smplayer"] move scratchpad' >/dev/null
			else
				i3-msg '[class="smplayer"] focus' >/dev/null
			fi
		else
			exec smplayer
		fi
	;;
	spotify)
		if pgrep -x "spotify" > /dev/null; then
			if [ "$AW_CLASS" = "Spotify" ]; then
				i3-msg "workspace back_and_forth" >/dev/null
			else
				i3-msg '[class="Spotify"] focus' >/dev/null
				# wmctrl -x -a spotify.Spotify
			fi
		else
			exec spotify
		fi
	;;
	vbox)
		if VBoxManage list vms runningvms | grep -q "$2"; then
			if [ "$AW_CLASS" = "VirtualBox Machine" ]; then
				i3-msg "workspace back_and_forth" >/dev/null
			else
				i3-msg "[class=(?i)VirtualBox title=(?i)$2] focus" >/dev/null
			fi
		else
			exec VBoxManage startvm "$2"
		fi
	;;
	vivaldi*)
		if pgrep -x "vivaldi-bin" > /dev/null; then
			if [ "$AW_CLASS" = "Vivaldi-${2:-stable}" ]; then
				i3-msg "workspace back_and_forth" >/dev/null
			else
				i3-msg "[class=\"Vivaldi-${2:-stable}\"] focus" >/dev/null
			fi
		else
			exec vivaldi-"${2:-stable}" --start-maximized
		fi
	;;
esac
