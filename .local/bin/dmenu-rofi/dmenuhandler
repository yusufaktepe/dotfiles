#!/bin/sh

opts="\
 copy url
 mpv
 mpv (loop)
 download
 youtube-dl
 youtube-dl (audio)
 browser
 sxiv
 w3m
 youtube:  add to favorites
 youtube:  like
 youtube:  dislike
"
case "$(printf '%s' "$opts" | dmenu -i -p "Open link with...?")" in
	" copy url")
		echo "$1" | xclip -selection clipboard ;;
	" mpv")
		ym "$1" >/dev/null 2>&1 & ;;
	" mpv (loop)")
		ym --loop "$1" >/dev/null 2>&1 & ;;
	" download")
		tsp curl -LO "$1" >/dev/null 2>&1 ;;
	" youtube-dl")
		tsp youtube-dl --write-metadata -ic "$1" >/dev/null 2>&1 ;;
	" youtube-dl (audio)")
		tsp youtube-dl --add-metadata -xic -f bestaudio/best "$1" >/dev/null 2>&1 ;;
	" browser")
		setsid "$BROWSER" "$1" >/dev/null 2>&1 & ;;
	" sxiv")
		tmp=/tmp/$(basename "$1")
		curl -sL "$1" > "$tmp" && setsid sxiv -a "$tmp" >/dev/null 2>&1 &
		wait; rm "$tmp" ;;
	" w3m")
		{ [ -t 2 ] && w3m "$1" 2>/dev/null ;} || $TERMINAL -e w3m "$1" 2>/dev/null ;;
	" youtube:  add to favorites")
		if youtube-viewer --no-interactive --favorite="$1"; then
			notify-send -a dmenuhandler -i youtube "YouTube" \
				"Video has been <b>added to favorites</b>.\n$1"
		else
			notify-send -a dmenuhandler -i youtube "YouTube" \
				"<b>Can't favorite video!</b>\n$1"
		fi ;;
	" youtube:  like")
		if youtube-viewer --no-interactive --like="$1"; then
			notify-send -a dmenuhandler -i youtube "YouTube" \
				"Video has been successfully <b>liked</b>.\n$1"
		else
			notify-send -a dmenuhandler -i youtube "YouTube" \
				"<b>Can't like video!</b>\n$1"
		fi ;;
	" youtube:  dislike")
		if youtube-viewer --no-interactive --dislike="$1"; then
			notify-send -a dmenuhandler -i youtube "YouTube" \
				"Video has been successfully <b>disliked</b>.\n$1"
		else
			notify-send -a dmenuhandler -i youtube "YouTube" \
				"<b>Can't dislike video!</b>\n$1"
		fi ;;
esac
