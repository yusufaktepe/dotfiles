#!/bin/sh
# A fuzzy file-finder and opener
# Requires: rofi, xdg-utils, mlocate
#           & ignore list in regex format
# ---
# 2019 Yusuf Aktepe <yusuf@yusufaktepe.com>
# https://github.com/yusufaktepe/dotfiles
# ---

ignore=$XDG_DATA_HOME/rofi/finder_ignore
tmp=$XDG_CACHE_HOME/rofi-finder.ls

mklist() {
	locate "/home/*" "/data/*" | grep -Ev "($(tr -d '\t\n' < $ignore | sed "s|~|$HOME|g"))" > $tmp
	printf " !Edit ignore list\n !System paths\n !Update search database" >> $tmp
}

if [ -e $tmp ]; then
	choise=$(rofi -dmenu -i -l 20 -width 60 -p "" < $tmp)
	mklist
else
	mklist
	choise=$(rofi -dmenu -i -l 20 -width 60 -p "" < $tmp)
fi

case "$choise" in
	"") exit ;;
	*) sudo -A updatedb && mklist && $0 ;;
	*) sys_choise=$(locate "/etc/*" "/usr/*" | rofi -dmenu -i -l 20 -width 60 -p "")
		case "$sys_choise" in
			"") exit ;;
			*)  xdg-open "$sys_choise" >/dev/null 2>&1 & ;;
		esac ;;
	*) $TERMINAL -e "$EDITOR" "$ignore" ;;
	*) xdg-open "$choise" >/dev/null 2>&1 & ;;
esac

